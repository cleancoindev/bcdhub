parameter (or :_entries (pair %_Liq_entry_transfer address nat) (or (pair %_Liq_entry_approve address nat) (or (pair %_Liq_entry_transferFrom address (pair address nat)) (or (pair %_Liq_entry_createAccount address nat) (or (list %_Liq_entry_createAccounts (pair address nat)) (or (pair %_Liq_entry_createVote string (pair timestamp (pair timestamp (pair nat (map string (lambda unit (list operation))))))) (or (pair %_Liq_entry_vote string string) (string %_Liq_entry_tallyVote))))))));
storage (pair :storage (big_map :accounts address (pair :account (nat %balance) (map %allowances address nat))) (pair (nat %version) (pair (nat %totalSupply) (pair (address %owner) (map %votes string (pair :vote (timestamp %start_date) (pair (timestamp %end_date) (pair (map %cast_votes address string) (pair (nat %min_quorum) (map %actions string (lambda unit (list operation))))))))))));
code { DUP ;
       DIP { CDR @storage_slash_1 } ;
       CAR @parameter_slash_2 ;
       LAMBDA @get_account (pair address (big_map address (pair :account (nat %balance) (map %allowances address nat)))) (pair :account (nat %balance) (map %allowances address nat)) { RENAME @_a_accounts_slash_3 ; DUP ; CDR @accounts ; { DIP { DUP } ; SWAP } ; CAR @a ; GET ; IF_NONE { PUSH (map address nat) {} ; PUSH nat 0 ; PAIR %balance %allowances } {} ; DIP { DROP } } ;
       DUP @get_account ;
       LAMBDA (pair (pair address (pair address (pair nat (pair :storage (big_map :accounts address (pair :account (nat %balance) (map %allowances address nat))) (pair (nat %version) (pair (nat %totalSupply) (pair (address %owner) (map %votes string (pair :vote (timestamp %start_date) (pair (timestamp %end_date) (pair (map %cast_votes address string) (pair (nat %min_quorum) (map %actions string (lambda unit (list operation))))))))))))))) (lambda (pair address (big_map address (pair :account (nat %balance) (map %allowances address nat)))) (pair :account (nat %balance) (map %allowances address nat)))) (pair (list operation) (pair :storage (big_map :accounts address (pair :account (nat %balance) (map %allowances address nat))) (pair (nat %version) (pair (nat %totalSupply) (pair (address %owner) (map %votes string (pair :vote (timestamp %start_date) (pair (timestamp %end_date) (pair (map %cast_votes address string) (pair (nat %min_quorum) (map %actions string (lambda unit (list operation))))))))))))) { RENAME @_from_dest_tokens_storage__get_account_slash_8 ; DUP ; CAR ; CAR @from ; { DIP { DUP } ; SWAP } ; CAR ; { CDR ; CAR @dest } ; { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ; CAR ; { CDR ; CDR ; CAR @tokens } ; { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ; CAR ; { CDR ; CDR ; CDR @storage } ; DUP @storage ; CAR @accounts %accounts ; { DIP { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CDR @get_account_slash_7 ; { DIP { DUP @accounts } ; SWAP } ; { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; PAIR ; EXEC @account_sender ; { DIP { DUP @accounts } ; SWAP } ; { DIP { { DIP { { DIP { { DIP { DUP @tokens } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; { DIP { { DIP { DUP @account_sender } ; SWAP } } ; SWAP } ; CAR %balance ; SUB ; ISNAT ; IF_NONE { PUSH string "Not enough tokens" ;
                 FAILWITH }
               { { DIP { { DIP { DUP @account_sender } ; SWAP } } ; SWAP } ;
                 CDR %allowances ;
                 SWAP ;
                 PAIR %balance %allowances } ; RENAME @new_account_sender ; { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; DIP { SOME } ; UPDATE @accounts ; { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CDR @get_account_slash_7 ; { DIP { DUP @accounts } ; SWAP } ; { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @dest } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; PAIR ; EXEC @account_dest ; { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CDR ; { DIP { { DIP { DUP @accounts } ; SWAP } } ; SWAP } ; { DIP { { DIP { DUP @account_dest } ; SWAP } } ; SWAP } ; CDR %allowances ; { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @tokens } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; { DIP { { DIP { { DIP { { DIP { DUP @account_dest } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CAR %balance ; ADD ; PAIR @new_account_dest %balance %allowances ; { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @dest } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; DIP { SOME } ; DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP } } } } ; UPDATE @accounts ; PAIR %accounts ; NIL operation ; PAIR } ;
       PAIR @perform_transfer ;
       { DIP { { DIP { DUP @parameter } ; SWAP } } ; SWAP } ;
       IF_LEFT { RENAME @_dest_tokens_slash_48 ;
                 { DIP { DUP @perform_transfer } ; SWAP } ;
                 { DIP { { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                 { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                 CDR @tokens ;
                 PAIR ;
                 { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                 CAR @dest ;
                 PAIR ;
                 SENDER ;
                 PAIR ;
                 DIP { DUP ; CAR ; SWAP ; CDR } ;
                 DIP { DIP { DIP { DROP } } } ;
                 PAIR ;
                 EXEC }
               { IF_LEFT { RENAME @_spender_tokens_slash_52 ;
                           { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           { DIP { DUP } ; SWAP } ;
                           CAR @spender ;
                           { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                           CDR @tokens ;
                           { DIP { { DIP { { DIP { { DIP { { DIP { DUP @get_account } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                           CAR %accounts ;
                           SENDER ;
                           PAIR ;
                           EXEC @account_sender ;
                           { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                           CDR ;
                           { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           CAR %accounts ;
                           { DIP { { DIP { DUP @account_sender } ; SWAP } } ; SWAP } ;
                           CAR %balance ;
                           PUSH nat 0 ;
                           { DIP { { DIP { { DIP { { DIP { { DIP { DUP @tokens } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           COMPARE ;
                           EQ ;
                           IF { { DIP { { DIP { { DIP { DUP @account_sender } ; SWAP } } ; SWAP } } ; SWAP } ;
                                CDR %allowances ;
                                { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @spender } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                DIP { NONE nat } ;
                                UPDATE }
                              { { DIP { { DIP { { DIP { DUP @account_sender } ; SWAP } } ; SWAP } } ; SWAP } ;
                                CDR %allowances ;
                                { DIP { { DIP { { DIP { { DIP { { DIP { DUP @tokens } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @spender } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                DIP { SOME } ;
                                UPDATE } ;
                           SWAP ;
                           PAIR @account_sender %balance %allowances ;
                           SENDER ;
                           DIP { SOME } ;
                           DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP } } } } ;
                           UPDATE ;
                           PAIR @storage %accounts ;
                           NIL operation ;
                           PAIR }
                         { IF_LEFT { RENAME @_from_dest_tokens_slash_59 ;
                                     { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { DIP { DUP } ; SWAP } ;
                                     CAR @from ;
                                     { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                                     { CDR ; CDR @tokens } ;
                                     { DIP { { DIP { { DIP { { DIP { { DIP { DUP @get_account } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CAR %accounts ;
                                     { DIP { { DIP { { DIP { DUP @from } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     PAIR ;
                                     EXEC @account_from ;
                                     { DIP { { DIP { { DIP { { DIP { { DIP { DUP @perform_transfer } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CDR ;
                                     { DIP { { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CAR %accounts ;
                                     { DIP { { DIP { { DIP { DUP @account_from } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CAR %balance ;
                                     { DIP { { DIP { { DIP { { DIP { DUP @account_from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CDR %allowances ;
                                     SENDER ;
                                     GET ;
                                     IF_NONE { PUSH string "Not allowed" ;
                                               FAILWITH }
                                             { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @tokens } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                               { DIP { DUP @allowed } ; SWAP } ;
                                               SUB ;
                                               ISNAT ;
                                               IF_NONE { PUSH string "Not enough allowance" ;
                                                         FAILWITH }
                                                       { PUSH nat 0 ;
                                                         { DIP { DUP @allowed } ; SWAP } ;
                                                         COMPARE ;
                                                         EQ ;
                                                         IF { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @account_from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                              CDR %allowances ;
                                                              SENDER ;
                                                              DIP { NONE nat } ;
                                                              UPDATE }
                                                            { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @account_from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                              CDR %allowances ;
                                                              { DIP { DUP @allowed } ; SWAP } ;
                                                              SENDER ;
                                                              DIP { SOME } ;
                                                              UPDATE } ;
                                                         DIP { DROP } } ;
                                               DIP { DROP } } ;
                                     RENAME @new_allowances_from ;
                                     SWAP ;
                                     PAIR @account_from %balance %allowances ;
                                     { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     DIP { SOME } ;
                                     UPDATE ;
                                     PAIR @storage %accounts ;
                                     { DIP { { DIP { { DIP { DUP @tokens } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     PAIR ;
                                     { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { CDR ; CAR @dest } ;
                                     PAIR ;
                                     { DIP { { DIP { { DIP { { DIP { DUP @from } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     PAIR ;
                                     DIP { DUP ; CAR ; SWAP ; CDR } ;
                                     DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP } } } ;
                                     PAIR ;
                                     EXEC }
                                   { IF_LEFT { RENAME @_dest_tokens_slash_70 ;
                                               { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                               DUP @storage ;
                                               { CDR ; CDR ; CDR ; CAR %owner } ;
                                               SENDER ;
                                               COMPARE ;
                                               NEQ ;
                                               IF { PUSH string "Only owner can create accounts" ;
                                                    FAILWITH }
                                                  { UNIT } ;
                                               DROP ;
                                               { DIP { { DIP { DUP @perform_transfer } ; SWAP } } ; SWAP } ;
                                               { DIP { DUP @storage } ; SWAP } ;
                                               { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ;
                                               CDR @tokens ;
                                               PAIR ;
                                               { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ;
                                               CAR @dest ;
                                               PAIR ;
                                               { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                                               { CDR ; CDR ; CDR ; CAR %owner } ;
                                               PAIR ;
                                               DIP { DUP ; CAR ; SWAP ; CDR } ;
                                               DIP { DIP { DIP { DROP ; DROP } } } ;
                                               PAIR ;
                                               EXEC }
                                             { IF_LEFT { RENAME @new_accounts_slash_74 ;
                                                         { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                         DUP @storage ;
                                                         { CDR ; CDR ; CDR ; CAR %owner } ;
                                                         SENDER ;
                                                         COMPARE ;
                                                         NEQ ;
                                                         IF { PUSH string "Only owner can create accounts" ;
                                                              FAILWITH }
                                                            { UNIT } ;
                                                         DROP ;
                                                         DUP @storage ;
                                                         NIL operation ;
                                                         PAIR ;
                                                         { DIP { { DIP { DUP @new_accounts } ; SWAP } } ; SWAP } ;
                                                         ITER { RENAME @_dest_tokens__ops_storage_slash_76 ; DIP { DUP } ; PAIR ; DUP ; CDR ; CDR @storage ; { DIP { { DIP { { DIP { { DIP { { DIP { DUP @perform_transfer } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; { DIP { DUP @storage } ; SWAP } ; { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ; CAR ; CDR @tokens ; PAIR ; { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ; CAR ; CAR @dest ; PAIR ; { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ; { CDR ; CDR ; CDR ; CAR %owner } ; PAIR ; DIP { DUP ; CAR ; SWAP ; CDR } ; DIP { DIP { DIP { DROP ; DROP ; DROP } } } ; PAIR ; EXEC } ;
                                                         DIP { DROP ; DROP } }
                                                       { IF_LEFT { RENAME @_name_start_date_end_date_min_quorum_actions_slash_81 ;
                                                                   { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { DIP { DUP } ; SWAP } ;
                                                                   CAR @name ;
                                                                   { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CAR @start_date } ;
                                                                   { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CDR ; CAR @end_date } ;
                                                                   { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CDR ; CDR ; CDR @actions } ;
                                                                   { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CDR ; CDR ; CAR %owner } ;
                                                                   SENDER ;
                                                                   COMPARE ;
                                                                   NEQ ;
                                                                   IF { PUSH string "Only owner can create vote" ;
                                                                        FAILWITH }
                                                                      { UNIT } ;
                                                                   DROP ;
                                                                   { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CDR ; CDR ; CDR %votes } ;
                                                                   { DIP { { DIP { { DIP { { DIP { DUP @name } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   MEM ;
                                                                   IF { PUSH string "Already exists" ;
                                                                        FAILWITH }
                                                                      { UNIT } ;
                                                                   DROP ;
                                                                   { DIP { DUP @end_date } ; SWAP } ;
                                                                   { DIP { { DIP { { DIP { DUP @start_date } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   COMPARE ;
                                                                   GT ;
                                                                   IF { PUSH string "End before start" ;
                                                                        FAILWITH }
                                                                      { UNIT } ;
                                                                   DROP ;
                                                                   PUSH nat 0 ;
                                                                   { DIP { DUP @actions } ; SWAP } ;
                                                                   SIZE ;
                                                                   COMPARE ;
                                                                   EQ ;
                                                                   IF { PUSH string "This vote has no choices" ;
                                                                        FAILWITH }
                                                                      { UNIT } ;
                                                                   DROP ;
                                                                   { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   DUP ;
                                                                   CAR %accounts ;
                                                                   SWAP ;
                                                                   CDR ;
                                                                   DUP ;
                                                                   CAR %version ;
                                                                   SWAP ;
                                                                   CDR ;
                                                                   DUP ;
                                                                   CAR %totalSupply ;
                                                                   SWAP ;
                                                                   CDR ;
                                                                   CAR %owner ;
                                                                   { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CDR ; CDR ; CDR %votes } ;
                                                                   { DIP { { DIP { { DIP { { DIP { { DIP { DUP @actions } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   { CDR ; CDR ; CDR ; CAR @min_quorum } ;
                                                                   PAIR %min_quorum %actions ;
                                                                   PUSH (map address string) {} ;
                                                                   PAIR %cast_votes ;
                                                                   { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @end_date } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   PAIR %end_date ;
                                                                   { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @start_date } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   PAIR %start_date ;
                                                                   { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @name } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                   DIP { SOME } ;
                                                                   DIP { DIP { DIP { DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP ; DROP } } } } } } } ;
                                                                   UPDATE ;
                                                                   SWAP ;
                                                                   PAIR %owner %votes ;
                                                                   SWAP ;
                                                                   PAIR %totalSupply ;
                                                                   SWAP ;
                                                                   PAIR %version ;
                                                                   SWAP ;
                                                                   PAIR %accounts ;
                                                                   NIL operation ;
                                                                   PAIR }
                                                                 { IF_LEFT { RENAME @_vote_name_vote_choice_slash_88 ;
                                                                             { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             { DIP { DUP } ; SWAP } ;
                                                                             CAR @vote_name ;
                                                                             { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                                                                             CDR @vote_choice ;
                                                                             { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                                                                             { CDR ; CDR ; CDR ; CDR %votes } ;
                                                                             { DIP { { DIP { DUP @vote_name } ; SWAP } } ; SWAP } ;
                                                                             GET ;
                                                                             IF_NONE { PUSH string "No such vote" ; FAILWITH } {} ;
                                                                             RENAME @vote ;
                                                                             DUP @vote ;
                                                                             CAR %start_date ;
                                                                             NOW ;
                                                                             COMPARE ;
                                                                             LT ;
                                                                             IF { PUSH string "Vote not started" ;
                                                                                  FAILWITH }
                                                                                { UNIT } ;
                                                                             DROP ;
                                                                             DUP @vote ;
                                                                             { CDR ; CAR %end_date } ;
                                                                             NOW ;
                                                                             COMPARE ;
                                                                             GT ;
                                                                             IF { PUSH string "Vote is over" ;
                                                                                  FAILWITH }
                                                                                { UNIT } ;
                                                                             DROP ;
                                                                             DUP @vote ;
                                                                             { CDR ; CDR ; CDR ; CDR %actions } ;
                                                                             { DIP { { DIP { DUP @vote_choice } ; SWAP } } ; SWAP } ;
                                                                             MEM ;
                                                                             NOT ;
                                                                             IF { PUSH string "Invalid vote choice" ;
                                                                                  FAILWITH }
                                                                                { UNIT } ;
                                                                             DROP ;
                                                                             { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             DUP ;
                                                                             CAR %accounts ;
                                                                             SWAP ;
                                                                             CDR ;
                                                                             DUP ;
                                                                             CAR %version ;
                                                                             SWAP ;
                                                                             CDR ;
                                                                             DUP ;
                                                                             CAR %totalSupply ;
                                                                             SWAP ;
                                                                             CDR ;
                                                                             CAR %owner ;
                                                                             { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             { CDR ; CDR ; CDR ; CDR %votes } ;
                                                                             { DIP { { DIP { { DIP { { DIP { { DIP { DUP @vote } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             DUP ;
                                                                             CAR %start_date ;
                                                                             SWAP ;
                                                                             CDR ;
                                                                             DUP ;
                                                                             CAR %end_date ;
                                                                             SWAP ;
                                                                             CDR ;
                                                                             CDR ;
                                                                             { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @vote } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             { CDR ; CDR ; CAR %cast_votes } ;
                                                                             { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @vote_choice } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             SENDER ;
                                                                             DIP { SOME } ;
                                                                             UPDATE ;
                                                                             PAIR %cast_votes ;
                                                                             SWAP ;
                                                                             PAIR %end_date ;
                                                                             SWAP ;
                                                                             PAIR @vote %start_date ;
                                                                             { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @vote_name } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             DIP { SOME } ;
                                                                             DIP { DIP { DIP { DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP } } } } } } } ;
                                                                             UPDATE ;
                                                                             SWAP ;
                                                                             PAIR %owner %votes ;
                                                                             SWAP ;
                                                                             PAIR %totalSupply ;
                                                                             SWAP ;
                                                                             PAIR %version ;
                                                                             SWAP ;
                                                                             PAIR @storage %accounts ;
                                                                             NIL operation ;
                                                                             PAIR }
                                                                           { RENAME @vote_name_slash_96 ;
                                                                             { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                             DUP @storage ;
                                                                             { CDR ; CDR ; CDR ; CDR %votes } ;
                                                                             { DIP { { DIP { DUP @vote_name } ; SWAP } } ; SWAP } ;
                                                                             GET ;
                                                                             IF_NONE { PUSH string "No such vote" ;
                                                                                       FAILWITH }
                                                                                     { DUP @vote ;
                                                                                       { CDR ; CAR %end_date } ;
                                                                                       NOW ;
                                                                                       COMPARE ;
                                                                                       LE ;
                                                                                       IF { PUSH string "Vote not over" ;
                                                                                            FAILWITH }
                                                                                          { UNIT } ;
                                                                                       DROP ;
                                                                                       { DIP { { DIP { { DIP { { DIP { DUP @get_account } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                       { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                                                                                       CAR %accounts ;
                                                                                       { DIP { { DIP { DUP @vote } ; SWAP } } ; SWAP } ;
                                                                                       { CDR ; CDR ; CAR %cast_votes } ;
                                                                                       PAIR ;
                                                                                       PAIR ;
                                                                                       PUSH (pair (map string nat) nat) (Pair {} 0) ;
                                                                                       { DIP { DUP } ; SWAP } ;
                                                                                       CAR @cast_votes_accounts_slash_24 ;
                                                                                       CAR @cast_votes ;
                                                                                       ITER { RENAME @_address_choice_counts_quorum_slash_27 ; DIP { DUP } ; PAIR ; DUP ; CAR ; CDR @choice ; { DIP { DUP } ; SWAP } ; CDR ; CAR @counts ; { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CDR @get_account_slash_7 ; { DIP { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CAR @cast_votes_accounts_slash_24 ; CDR @accounts ; { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CAR ; CAR @address ; PAIR ; EXEC ; CAR @stake %balance ; DUP @stake ; { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; CDR ; CDR @quorum ; ADD ; { DIP { { DIP { DUP @counts } ; SWAP } } ; SWAP } ; { DIP { { DIP { { DIP { DUP @counts } ; SWAP } } ; SWAP } } ; SWAP } ; { DIP { { DIP { { DIP { { DIP { { DIP { DUP @choice } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; GET ; IF_NONE { { DIP { { DIP { DUP @stake } ; SWAP } } ; SWAP } }
                                                                                               { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                 ADD } ; RENAME @total_stake ; { DIP { { DIP { { DIP { { DIP { { DIP { DUP @choice } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ; DIP { SOME } ; DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP } } } } ; UPDATE ; PAIR } ;
                                                                                       RENAME @_tally_quorum ;
                                                                                       DUP ;
                                                                                       CDR @quorum ;
                                                                                       PUSH (or :vote_result (nat %Draw) (pair %Winner string nat)) (Left 0) ;
                                                                                       { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                                                                                       CAR @tally ;
                                                                                       ITER { RENAME @_choice_total_winner_slash_38 ; DIP { DUP } ; PAIR ; DUP ; CAR ; CAR @choice ; { DIP { DUP } ; SWAP } ; CAR ; CDR @total ; { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ; CDR @winner ; DUP @winner ; IF_LEFT { RENAME @prev_total_slash_42 ;
                                                                                                 { DIP { { DIP { DUP @total } ; SWAP } } ; SWAP } ;
                                                                                                 { DIP { DUP @prev_total } ; SWAP } ;
                                                                                                 COMPARE ;
                                                                                                 GE ;
                                                                                                 IF { { DIP { DUP @winner } ; SWAP } }
                                                                                                    { { DIP { { DIP { DUP @total } ; SWAP } } ; SWAP } ;
                                                                                                      { DIP { { DIP { { DIP { { DIP { DUP @choice } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                      PAIR ;
                                                                                                      RIGHT % %Winner nat } ;
                                                                                                 DIP { DROP } }
                                                                                               { RENAME @___prev_total_slash_43 ;
                                                                                                 DUP ;
                                                                                                 CDR @prev_total ;
                                                                                                 { DIP { { DIP { { DIP { DUP @total } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                 { DIP { DUP @prev_total } ; SWAP } ;
                                                                                                 COMPARE ;
                                                                                                 EQ ;
                                                                                                 IF { { DIP { { DIP { { DIP { DUP @total } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                      LEFT %Draw % (pair string nat) }
                                                                                                    { { DIP { { DIP { { DIP { DUP @total } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                      { DIP { DUP @prev_total } ; SWAP } ;
                                                                                                      COMPARE ;
                                                                                                      GT ;
                                                                                                      IF { { DIP { { DIP { DUP @winner } ; SWAP } } ; SWAP } }
                                                                                                         { { DIP { { DIP { { DIP { DUP @total } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                           { DIP { { DIP { { DIP { { DIP { { DIP { DUP @choice } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                           PAIR ;
                                                                                                           RIGHT % %Winner nat } } ;
                                                                                                 DIP { DROP ; DROP } } ; DIP { DROP ; DROP ; DROP ; DROP ; DROP } } ;
                                                                                       DIP { DIP { DROP ; DROP } } ;
                                                                                       RENAME @winner ;
                                                                                       PAIR ;
                                                                                       { DIP { DUP @vote } ; SWAP } ;
                                                                                       { CDR ; CDR ; CDR ; CAR %min_quorum } ;
                                                                                       { DIP { DUP } ; SWAP } ;
                                                                                       CDR @quorum ;
                                                                                       COMPARE ;
                                                                                       LT ;
                                                                                       IF { PUSH string "Quorum not reached" ;
                                                                                            FAILWITH }
                                                                                          { UNIT } ;
                                                                                       DROP ;
                                                                                       { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                                                                                       DUP ;
                                                                                       CAR %accounts ;
                                                                                       SWAP ;
                                                                                       CDR ;
                                                                                       DUP ;
                                                                                       CAR %version ;
                                                                                       SWAP ;
                                                                                       CDR ;
                                                                                       DUP ;
                                                                                       CAR %totalSupply ;
                                                                                       SWAP ;
                                                                                       CDR ;
                                                                                       CAR %owner ;
                                                                                       { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                       { CDR ; CDR ; CDR ; CDR %votes } ;
                                                                                       { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @vote_name } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                       DIP { NONE (pair :vote (timestamp %start_date) (pair (timestamp %end_date) (pair (map %cast_votes address string) (pair (nat %min_quorum) (map %actions string (lambda unit (list operation))))))) } ;
                                                                                       UPDATE ;
                                                                                       SWAP ;
                                                                                       PAIR %owner %votes ;
                                                                                       SWAP ;
                                                                                       PAIR %totalSupply ;
                                                                                       SWAP ;
                                                                                       PAIR %version ;
                                                                                       SWAP ;
                                                                                       PAIR @storage %accounts ;
                                                                                       { DIP { DUP } ; SWAP } ;
                                                                                       CAR @winner ;
                                                                                       IF_LEFT { DROP ;
                                                                                                 DUP ;
                                                                                                 NIL operation ;
                                                                                                 PAIR }
                                                                                               { RENAME @_choice___slash_104 ;
                                                                                                 { DIP { DUP @storage } ; SWAP } ;
                                                                                                 { DIP { { DIP { { DIP { { DIP { DUP @vote } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                                                                 { CDR ; CDR ; CDR ; CDR %actions } ;
                                                                                                 { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                                                                                                 CAR @choice ;
                                                                                                 GET ;
                                                                                                 IF_NONE { UNIT ; FAILWITH } {} ;
                                                                                                 DIP { DIP { DROP } } ;
                                                                                                 RENAME @action ;
                                                                                                 UNIT ;
                                                                                                 EXEC ;
                                                                                                 PAIR } ;
                                                                                       DIP { DROP ; DROP ; DROP } } ;
                                                                             DIP { DROP ; DROP } } } } } } } } ;
       DIP { DROP ; DROP ; DROP ; DROP } }